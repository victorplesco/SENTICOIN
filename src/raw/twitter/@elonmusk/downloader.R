#################################################################################################################################################################################################################################################################################
## Setup Environment ############################################################################################################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

require(stringr); require(devtools); load_all("./SENTICOIN/src/packages/racademic/"); 
token <- v2_create_token(token = "INSERT_NEW_KEY");

#################################################################################################################################################################################################################################################################################
## Download Elon Musk's Tweets From 1st of Jan. 2021 to 12th of Oct. 2021 #######################################################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

home.path <- "./SENTICOIN/src/data/raw/twitter/@elonmusk/rds/tweets/";
tweets <- v2_search_fullarchive(token = token, next_token = NULL, safe.dir = home.path, 
                                query = "from:elonmusk lang:en", max_results = 100, 
                                start_time = "2021-01-01T00:00:00Z", end_time = "2021-10-12T00:00:00Z", since_id = NULL, until_id = NULL,
                                tweet.fields = "all", user.fields = "all", media.fields = "all", place.fields = "all", poll.fields = "all", expansions = "all"); rm(home.path);

# conversation_id of Elon Musk's "Dogecoin is the people's crypto": 1357241340313141249
sapply(tweets$data[which(str_detect(sapply(tweets$data, "[[", "text"), "Dogecoin is the people’s crypto") == TRUE)], "[[", "conversation_id");
# created_at of Elon Musk's "Dogecoin is the people's crypto": 2021-02-04T08:15:26.000Z
sapply(tweets$data[which(str_detect(sapply(tweets$data, "[[", "text"), "Dogecoin is the people’s crypto") == TRUE)], "[[", "public_metrics");
rm(home.path, tweets);

#################################################################################################################################################################################################################################################################################
## Download Retweets to Elon Musk's "Dogecoin is the people's crypto" Until Midnight of the Same Day ############################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

home.path <- "./SENTICOIN/src/data/raw/twitter/@elonmusk/rds/retweets/";
retweets <- v2_search_fullarchive(token = token, next_token = NULL, safe.dir = home.path, 
                                  query = "conversation_id:1357241340313141249", max_results = 500, 
                                  start_time = "2021-02-04T08:15:26Z", end_time = "2021-02-05T00:00:00Z", since_id = NULL, until_id = NULL,
                                  tweet.fields = c("id", "text", "conversation_id", "created_at"), user.fields = NULL, media.fields = NULL, place.fields = NULL, poll.fields = NULL, expansions = NULL); 

#################################################################################################################################################################################################################################################################################
## Save #########################################################################################################################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

write.csv(data.frame(tweet_id        = sapply(retweets$data, "[[", "id"),
                     text            = sapply(retweets$data, "[[", "text"), 
                     conversation_id = sapply(retweets$data, "[[", "conversation_id"), 
                     created_at      = sapply(retweets$data, "[[", "created_at")), "./SENTICOIN/src/data/raw/twitter/@elonmusk/csv/retweets.csv", row.names = FALSE); rm(home.path, retweets, token);